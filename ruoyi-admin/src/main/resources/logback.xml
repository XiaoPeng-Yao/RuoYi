<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="600 seconds" debug="true">
<!-- 这个日志配置文件，区分了windows和linux机器，windows机器日志输出到控制台，linux机器日志输出文件，这个配置满足大部分项目需求 -->
	<if condition='property("os.name").contains("Windows")'>
		<then>
			<!-- 控制台输出 -->
			<appender name="Console" class="ch.qos.logback.core.ConsoleAppender">
				<encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
					<!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符-->
					<pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread]   %-5level %logger{50} - %msg%n</pattern>
				</encoder>
			</appender>
			<logger name="com.ruoyi" level="DEBUG" />
			<logger name="ch.qos.logback" level="WARN" />
			<root level="DEBUG">
				<appender-ref ref="Console" /><!-- 输出到控制台-->
			</root>
		</then>
		<else>
			<property name="LOG_HOME" value="${user.dir}/log" />
			<!-- 日志输出格式 -->
			<property name="log.pattern" value="%d{HH:mm:ss.SSS} [%thread] %-5level %logger{20} - [%method,%line] - %msg%n" />
			<!-- 普通日志，INFO -->
			<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
				<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
					<FileNamePattern>
						${LOG_HOME}/%d{yyyy-MM-dd}.%i.log
						<timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
							<maxFileSize>100MB</maxFileSize>
						</timeBasedFileNamingAndTriggeringPolicy>
					</FileNamePattern>
					<!-- 保留最多15天的日志，过期的日志会被自动删除 -->
				    <maxHistory>10</maxHistory>
				    <!-- 保留最多3GB的日志，过期的日志会被自动删除 -->
				    <totalSizeCap>3GB</totalSizeCap>
				</rollingPolicy>
				<encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
					<pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
				</encoder>
			</appender>
			
			<!-- 错误日志，ERROR -->
			<appender name="FILE_ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
				<!-- 过滤器，只记录WARN级别的日志 -->  
		        <filter class="ch.qos.logback.classic.filter.LevelFilter">  
		            <level>ERROR</level>
		            <onMatch>ACCEPT</onMatch>  
		            <onMismatch>DENY</onMismatch>  
		        </filter>  
				<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
					<FileNamePattern>
						${LOG_HOME}/%d{yyyy-MM-dd}.%i.error.log
						<timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
							<maxFileSize>100MB</maxFileSize>
						</timeBasedFileNamingAndTriggeringPolicy>
					</FileNamePattern>
					<!-- 保留最多15天的日志，过期的日志会被自动删除 -->
				    <maxHistory>15</maxHistory>
				    <!-- 保留最多3GB的日志，过期的日志会被自动删除 -->
				    <totalSizeCap>3GB</totalSizeCap>
				</rollingPolicy>
				<encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
					<pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
				</encoder>
			</appender>

			<!-- 用户访问日志输出  -->
			<appender name="sys-user" class="ch.qos.logback.core.rolling.RollingFileAppender">
				<file>${LOG_HOME}/sys-user.log</file>
				<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
					<!-- 按天回滚 daily -->
					<fileNamePattern>${LOG_HOME}/sys-user.%d{yyyy-MM-dd}.log</fileNamePattern>
					<!-- 日志最大的历史 60天 -->
					<maxHistory>60</maxHistory>
				</rollingPolicy>
				<encoder>
					<pattern>${log.pattern}</pattern>
				</encoder>
			</appender>


			<logger name="com.ruoyi" level="INFO" />
			<logger name="ch.qos.logback" level="WARN" />
			<!-- Spring日志级别控制  -->
			<logger name="org.springframework" level="warn" />
			<root level="DEBUG">
				<appender-ref ref="FILE" />
				<appender-ref ref="FILE_ERROR" />
			</root>
			<!--系统用户操作日志-->
			<logger name="sys-user" level="info">
				<appender-ref ref="sys-user"/>
			</logger>
		</else>
	</if>
	
</configuration>