<!DOCTYPE HTML>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta http-equiv="Content-Type" content="text/html ;charset=utf-8" />
<head>
    <th:block th:include="include :: header('日期和时间')" />
    <th:block th:include="include :: datetimepicker-css"/>
    <th:block th:include="include :: bootstrap-select-css"/>
</head>
<!--<link th:href="@{/ajax/libs/datapicker/bootstrap-datetimepicker.css}" rel="stylesheet"/>-->
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">

    <div class="container">
        <div class="row">
            <div class="col-xs-2">
                <img src="../static/img/silergy.jpg" th:src="@{/img/silergy.jpg}">
            </div>
            <div class="col-xs-5">
                <h2 class="my-h2" >
                    南京矽力微电子技术有限公司
                </h2>

                <ul class="list-inline">
                    <li>
                        <h2 class="my-h3">签   呈 Petition</h2>
                        <br>
                    </li>
                </ul>

            </div>
        </div>
    </div>

    <form action="none" id="form-petition-add">
        <div id="for-boder1">
            <table class="my-table1" border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr>
                    <td colspan="6" style="width: 40%" class="text-left" >请选择类别:
                        <select style="border: black" name="typeType" id="type" required>
                            <option value="1">A: 用印签呈</option>
                            <option value="2">B: 请采购签呈</option>
                            <option value="3">C: 其他</option>
                        </select>
                    </td>
                    <td  id="comNo" style="width: 25%" class="text-right"> <!--<h5>矽字第 No.<input type="text" name="comNo"  style="border:none;" >号</h5>--></td>
                </tr>
            </table>
        </div>
        <div id="for-boder">
            <table class="my-table" width="100%">
                <tr id="topic1">
                    <td class="text-left" colspan="9"><h4>主题  Topic：</h4></td>
                </tr>
                <tr id="topic2">
                    <td class="text-left" colspan="9">
                        <textarea autoHeight="true"  type="text" id="topic" style="resize:none;" rows="3" class="form-control" name="topicObj" placeholder="请输入250内的文字内容"  ></textarea>
                    </td>
                </tr>
                <tr id="exp1">
                    <td class="text-left" colspan="9"><h4>说明  Explanation：</h4></td>
                </tr>
                <tr id="exp2">
                    <td class="text-center" colspan="9">
                        <textarea autoHeight="true"  style="resize:none; " type="text"  rows="6" name="explanation" class="form-control" placeholder="请输入一千字以内的文字内容" ></textarea>
                    </td>
                </tr>
                <tr id="curr" style="height: 40px;">
                    <td colspan="9" class="text-left" style="position: relative;"><b>币别: </b>
                        <input  name="curr" type="radio" value="美元" style="border:none;" required/>美元
                        <input  name="curr" type="radio" value="人民币"  style="border:none;" required />人民币
                        <input  name="curr" type="radio" value="台币"  style="border:none;" required />台币
                    </td>
                </tr>
                <tr id="monery"  >
                    <td  colspan="9" class="text-left"><b>金额:</b><label><input class="form-control" name="moneyM" id="moneyM" type="text" style="border:none;border-bottom:1px solid #000;" placeholder="例如2000"></label></td>
                </tr>
                <tr>
                    <td colspan="9" class="text-left"><h4>附件  Attachment: </h4><input class="form-control" type="file" id="file" name="file" multiple="multiple"> </td>
                </tr>
                <tr id="sealtype" >
                    <td colspan="9" rowspan="1" class="text-left" width="100%"><h4>使用印鉴:
                        <label class="checkbox-inline" id="1" >
                            <input type="radio" value="1" name="sealType" required/> 公章
                        </label>
                        <label class="checkbox-inline" id="2">
                            <input type="radio" value="2" name="sealType"/> 法人章
                        </label>
                        <label class="checkbox-inline" id="3">
                            <input type="radio" value="3" name="sealType"/> 财务章
                        </label>
                        <label class="checkbox-inline" id="4">
                            <input type="radio" value="4" name="sealType"/> 合同章
                        </label>
                        <label class="checkbox-inline" id="5">
                            <input type="radio" value="5" name="sealType"/> 法人章(经济部小章)
                        </label>
                        <label class="checkbox-inline" id="6">
                            <input type="radio" value="6" name="sealType"/> 法人章(经济部大章)
                        </label>
                        <label class="checkbox-inline" id="7">
                            <input type="radio" value="7" name="sealType"/> 印鉴大章
                        </label>
                        <label class="checkbox-inline" id="8">
                            <input type="radio" value="8" name="sealType"/> 印鉴小章
                        </label>
                        <label class="checkbox-inline" id="9">
                            <input type="radio" value="9" name="sealType"/> 其他
                            <input type="text" name="seal" style="border:none;border-bottom:1px solid #000;"/>
                        </label>
                    </h4>
                    </td>
                </tr>
                <tr id="seal3">
                    <td colspan="9" rowspan="1" class="text-left" width="100%" style="white-space:nowrap"><h4>印鉴使用说明:
                    <label class="checkbox-inline">
                         <input type="radio" value="1" name="sealExplain" required/> 直接用印:
                    </label>
                    <label class="checkbox-inline">
                         <input type="radio" value="2" name="sealExplain"/> 外借:
                   </label>
                    <input type="text" name="sealDate" class="datetimepicker-yyyy-mm-dd"  style="border:none; " placeholder="选择日期" >
                    </h4>
                  </td>
                </tr>
                <!--<tr id="sealFileExplain1"  >
                    <td   colspan="9" class="text-left"><h4>用印文件说明</h4></td>
                </tr>
                <tr id="sealFileExplain2" >
                    <td colspan="9" class="text-left">
                        <textarea type="text"  name="sealFileExplain" class="form-control" rows="2"style="resize:none;"  placeholder="请输入100字以内的文字内容"></textarea>
                    </td>
                </tr>-->
                <tr>
                    <td colspan="9" class="text-left">
                        <textarea autoHeight="true" type="text" name="moreExplain" class="form-control" rows="2" style="resize:none;" placeholder="补充内容"></textarea>
                    </td>
                </tr>
                <tr>
                    <td colspan="2"class="text-center">公司</td>
                    <td class="text-center" colspan="3">
                        <select style="border: black" name="company"class="form-control" id="company" required>
                            <option value="">请选择</option>
<!--                            <option value="5">杭州</option>-->
<!--                            <option value="7">西安</option>-->
<!--                            <option value="17">成都</option>-->
<!--                            <option value="19">上海</option>-->
<!--                            <option value="3">韩国</option>-->
<!--                            <option value="16">印度</option>-->
<!--                            <option value="15">日本</option>-->
<!--                            <option value="12">台湾矽力杰</option>-->
                            <option value="6">南京</option>
<!--                            <option value="13">香港</option>-->
                            <option value="14">上海矽力杰微电子</option>
                            <option value="20">南京香港</option>
<!--                            <option value="4">美国</option>-->
<!--                            <option value="9">萨摩亚</option>-->
<!--                            <option value="1">corp</option>-->
<!--                            <option value="21">矽望</option>-->
<!--                            <option value="22">合肥</option>-->
<!--                            <option value="23">澳门</option>-->
<!--                            <option value="0">其他</option>-->
                        </select>
                    </td>
                    <td  colspan="2" class="text-center">部门</td>
                    <td colspan="2" class="text-center">
                        <input id="dept" name="dept" class="form-control" type="text" required>
                    </td>
                </tr>
                <tr>
                    <td class="text-center" colspan="2">工号</td>
                    <td colspan="3">
                        <input class="form-control" name="sid" id="sid" type="text" required>
                    </td>
                    <td colspan="2"></td>
                    <td colspan="2"></td>
                </tr>
                <tr>
                    <td class="text-center" colspan="2">申请人</td>
                    <td colspan="3">
                        <input id="applyname" name="applyname" class="form-control" type="text" required>
                    </td>
                    <td colspan="2" class="text-center">
                        <input   type="text" name="applydate" class="form-control datetimepicker-yyyy-mm-dd nowdate" placeholder="申请日期" required="true">
                  </td>
                    <td colspan="2"></td>
                </tr>
                <tr id="law1">
                    <td colspan="9" class="text-left">
                        <h4>凡用印内容涉及到条款，请先请法务签核。</h4>
                    </td>
                </tr>
                <tr id="law2">
                    <td class="text-center" colspan="2" width="15%">法务签核</td>
                    <td colspan="2">
                        <select  class="form-control" name="law" id="law">
                            <option value="">请选择是否法务审核</option>
                            <option value="2">不需要</option>
                            <optgroup label="人员">
<!--                                <option value="1">王颖</option>-->
                                <option value="3">罗梅姣</option>
                            </optgroup>
                        </select>
                    </td>
                    <td colspan="1" class="text-center" width="18%">
                        <select  class="form-control" name="lawSta" disabled="true">
                            <option value="">签核意见</option>
                            <option value="1">同意</option>
                            <option value="2">不同意</option>
                        </select>
                    </td>

                    <td colspan="2" class="text-center">
                        <input  type="text" name="lawDate" class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期" disabled="true">
                    </td>
                    <td colspan="2">
                        <input class="form-control" id="lawIdea" name="lawIdea" type="text" placeholder="备注" disabled="true" required>
                    </td>
                </tr>
                <tr>
                    <td class="text-center" colspan="2" width="15%">部门主管</td>
                    <td colspan="2">
                        <input class="form-control" id="deptmanagerSid"  name="deptmanagerSid" type="hidden">
                        <input class="form-control" id="deptmanager"  name="deptmanager" type="text" readonly>
                    </td>
                    <td colspan="1" class="text-center" width="18%">
                        <select  class="form-control" name="deptmanagerSta" disabled="true">
                            <option value="">签核意见</option>
                            <option value="1">同意</option>
                            <option value="2">不同意</option>
                        </select>
                    </td>

                    <td colspan="2" class="text-center">
                        <input  type="text" name="deptmanageDate" class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期" disabled="true">
                    </td>
                    <td colspan="2">
                        <input class="form-control" id="deptmanagerIdea" name="deptmanagerIdea" type="text" placeholder="备注" disabled="true" required>
                    </td>
                </tr>

                <tr id="acoffer" >
                    <td  colspan="2"class="text-center">核准人:</td>
                    <td colspan="2" class="text-center name-data-position">
                        <div class="input-group" style="width: 98%;margin-left: 1%">
                            <select id="acOfficerSid" name="acOfficerSid" class="form-control text-center selectpicker"
                                    data-live-search="true" >
                                <option value="">请选择</option>
                            </select>
                        </div>
<!--                        <input class="form-control name-data" autocomplete="off"  placeholder="请输入核准人姓名" name="acOfficer" id="acOfficer" onclick="nameData()">-->
                    </td>
                    <td colspan="1" class="text-center">
                        <select name="acOfficerSta" class="form-control"   disabled="true">
                            <option value="">审核意见</option>
                            <option  value="1">同意</option>
                            <option value="2">不同意</option>
                        </select>
                    </td>
                    <td colspan="2" class="text-center">
                        <input type="text" name="acOfficerDate"  class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期"  disabled="true">
                    </td>
                    <td colspan="2">
                        <input class="form-control" id="acOfficerIdea" name="acOfficerIdea"   placeholder="备注" disabled="true"  type="text" required>
                    </td>


                </tr>
<!--                <tr id="fcManager" >-->
<!--                    <td colspan="2" class="text-center" width="15%">核准人:财务总账</td>-->
<!--                    <td colspan="2" class="text-center">-->
<!--                        <select name="fcManager" class="form-control"  id="fc" >-->
<!--                            <option value="">请选择财务总账</option>-->
<!--                            <option  value="1">王娜</option>-->
<!--                            <option value="2">畅佩华</option>-->
<!--                            <option  value="3">马海云</option>-->
<!--                            <option  value="4">林佳怡</option>-->
<!--                            <option  value="5">韓詩蕙</option>-->
<!--                            <option  value="6">张玲</option>-->
<!--                            <option  value="7">夏晶</option>-->
<!--                            <option  value="8">叶小仙</option>-->
<!--                            <option  value="9">庞杭艳</option>-->
<!--                            <option  value="10">王晶</option>-->
<!--                            <option  value="11">高甜</option>-->
<!--                        </select>-->
<!--                    </td>-->
<!--                    <td colspan="1" class="text-center" width="18%">-->
<!--                        <select  name="fcManagerSta" class="form-control"  disabled="true"   >-->
<!--                            <option value="">审核意见</option>-->
<!--                            <option value="1">同意</option>-->
<!--                            <option  value="2">不同意</option>-->
<!--                        </select>-->
<!--                    </td>-->
<!--                    <td colspan="2">-->
<!--                        <input type="text" name="fcManagerDate"  class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期"  disabled="true">-->
<!--                    </td>-->
<!--                    <td colspan="2">-->
<!--                        <input class="form-control" id="fcManagerIdea" name="fcManagerIdea"  placeholder="备注" disabled="true"  type="text" required>-->
<!--                    </td>-->


<!--                </tr>-->

<!--                <tr id="cfcoManager" >-->
<!--                    <td  colspan="2" class="text-center" >核准人:财务经理</td>-->
<!--                    <td colspan="2" class="text-center" >-->
<!--                        <select  name="cfcoManager" class="form-control"  id="cfco">-->
<!--                            <option  value="2">Bight(庞杭艳)</option>-->
<!--                            <option  value="3">陈京晶</option>-->
<!--                        </select>-->
<!--                    </td>-->
<!--                    <td colspan="1" class="text-center">-->
<!--                        <select name="cfcoManagerSta" class="form-control"    disabled="true">-->
<!--                            <option value="">审核意见</option>-->
<!--                            <option  value="1">同意</option>-->
<!--                            <option  value="2">不同意</option>-->
<!--                        </select>-->
<!--                    </td>-->
<!--                    <td colspan="2">-->
<!--                        <input type="text" name="cfcoManagerDate"   class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期" disabled="true">-->
<!--                    </td>-->
<!--                    <td colspan="2">-->
<!--                        <input class="form-control" id="cfcoManagerIdea" name="cfcoManagerIdea"   placeholder="备注" disabled="true"  type="text" required>-->
<!--                    </td>-->



                </tr>
                <tr id="gmSta" >
                    <td  colspan="2"class="text-center">核准人:</td>
                    <td colspan="2" class="text-center name-data-position">
                        <div class="input-group" style="width: 98%;margin-left: 1%">
                            <select id="gmSid" name="gmSid" class="form-control text-center selectpicker"
                                    data-live-search="true" >
                                <option value="">请选择</option>
                            </select>
                        </div>
<!--                       <input class="form-control name-data" autocomplete="off" placeholder="(请输入核准人姓名)可选" name="gm" id="gm" onclick="nameData()">-->
                    </td>
                    <td colspan="1" class="text-center">
                        <select name="gmSta" class="form-control"   disabled="true">
                            <option value="">审核意见</option>
                            <option  value="1">同意</option>
                            <option value="2">不同意</option>
                        </select>
                    </td>
                    <td colspan="2" class="text-center">
                        <input type="text" name="gmDate"  class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期"  disabled="true">
                    </td>
                    <td colspan="2">
                        <input class="form-control" id="gmIdea" name="gmIdea"   placeholder="备注" disabled="true"  type="text" required>
                    </td>


                </tr>
                <tr id="hr">
                    <td colspan="2" class="text-center">印鉴保管人审核</td>
                    <td colspan="2" class="text-center">
                        <select  class="form-control" name="hr" id="hr1" >
                            <optgroup label="请根据地区选择保管人">
                            </optgroup>
<!--                            <optgroup label="杭州">-->
<!--                                <option  value="1">周婕</option>-->
<!--                                <option   value="2">沈科如</option>-->
<!--                                <option   value="3">王娜</option>-->
<!--                            </optgroup>-->
<!--                            <optgroup label="台湾">-->
<!--                                <option   value="4">黃奕晨</option>-->
<!--                                <option   value="5">韓詩蕙</option>-->
<!--                            </optgroup>-->
                            <optgroup label="南京">
                                <option   value="6">戎玲</option>
                                <option   value="8">陈京晶</option>
                                <option   value="9">张玲</option>
                            </optgroup>
<!--                            <optgroup label="西安">-->
<!--                                <option  value="10">白永江</option>-->
<!--                                <option   value="11">王卓亚</option>-->
<!--                                <option   value="7">畅佩华</option>-->
<!--                            </optgroup>-->
<!--                            <optgroup label="成都">-->
<!--                                <option   value="12">马海云</option>-->
<!--                                <option   value="13">陈君</option>-->
<!--                                <option   value="14">宁卓</option>-->
<!--                            </optgroup>-->
<!--                            <optgroup label="corp">-->
<!--                                <option   value="15">潘冠呈</option>-->
<!--                                <option   value="16">陳紹偉</option>-->
<!--                                <option   value="19">沈科如</option>-->
<!--                            </optgroup>-->
                            <optgroup label="上海">
                                <option   value="17">付婷</option>
<!--                                <option   value="18">王菲</option>-->
                            </optgroup>
<!--                            <optgroup label="合肥">-->
<!--                                <option   value="20">周婕</option>-->
<!--                                <option   value="21">高甜</option>-->
<!--                            </optgroup>-->
<!--                            <optgroup label="澳门">-->
<!--                                <option   value="22">李冬梅</option>-->
<!--                            </optgroup>-->
                        </select>
                    </td>
                    <td colspan="1" class="text-center">
                        <select name="hrSta" class="form-control"  disabled="true"   >
                            <option value="">审核意见</option>
                            <option  value="1">同意</option>
                            <option value="2">不同意</option>
                        </select>
                    </td>
                    <td colspan="2">
                        <input type="text" name="hrStaDate" class="form-control datetimepicker-yyyy-mm-dd" placeholder="签核日期" disabled="true">
                    </td>
                    <td colspan="2">
                        <input class="form-control" id="hrIdea" name="hrIdea"   placeholder="备注" disabled="true"  type="text" required>
                    </td>

                </tr>

                <tr>
                    <td class="text-right" colspan="9">
                        <button type="button" onclick="add()"><i class="fa fa-plus-square"></i>添加一行</button>
                    </td>
                </tr>
                <tbody class="my-table2">
                <tr id="addColumn" class="addaudit">
                    <td class="text-center" colspan="3"><a href="javascript:void(0)" class="operate-tr1"><i class="fa fa-minus-square-o"></i></a></td>
                    <td class="text-center" colspan="3">添加核准人</td>
                    <td colspan="3" class="name-data-position"> 
                        <div class="input-group" style="width: 98%;margin-left: 1%">
                            <select id="addname" name="addname" class="form-control text-center selectpicker addname"
                                    data-live-search="true" >
                                <option value="">请选择</option>
                            </select>
                        </div>
<!--                        <input class="form-control name-data" autocomplete="off"  id="addname" placeholder="请输入核准人姓名(可选)"onclick="nameData()">-->
                    </td>
                </tr>
                </tbody>
                <tr>
                    <td class="text-right" colspan="9" id="nopt">
                        <button type="button" onclick="addTrial()"><i class="fa fa-plus-square"></i>添加一行</button>
                    </td>
                </tr>
                <tbody class="my-table-trial">
                <tr id="addTrialColumn" class="addtrial">
                    <td class="text-center" colspan="3"><a href="javascript:void(0)" class="operate-tr-trial"><i class="fa fa-minus-square-o"></i></a></td>
                    <td class="text-center" colspan="3">添加会审人</td>
                    <td colspan="3" class="name-data-position">
                        <div class="input-group" style="width: 98%;margin-left: 1%">
                            <select id="addTrialName" name="addTrialName" class="form-control text-center selectpicker addTrialName"
                                    data-live-search="true" >
                                <option value="">请选择</option>
                            </select>
                        </div>
<!--                        <input class="form-control name-data" autocomplete="off"  id="addTrialName" placeholder="请输入会审人姓名(可选)"onclick="nameData()">-->
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="col-sm-offset-5 col-sm-10 bottom">
<!--
            <button type="button" class="btn btn-sm btn-primary" onclick="submit()"><i class="fa fa-save"></i>提交</button>
-->

            <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-send"></i>提交</button>
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关闭</button>
        </div>

    </form>

</div>
<div th:include="include::footer"></div>
<div th:include="include::bootstrap-select-js"></div>
<script th:src="@{/js/jquery-ui-1.10.4.min.js}"></script>
<script th:src="@{/ajax/libs/iCheck/icheck.min.js}"></script>
<script th:src="@{/ajax/libs//datapicker/bootstrap-datetimepicker.min.js}"></script>
<script th:src="@{/ajax/libs/beautifyhtml/beautifyhtml.js}"></script>
<script th:src="@{/ajax/libs/typeahead/bootstrap-typeahead.min.js}"></script>
<script type="text/javascript">

    $(function () {
        $("#comNo").hide();
        $("#nopt").hide();
        $("#addTrialColumn").hide();
    });
    $(function(){
        $(".datetimepicker-yyyy-mm-dd").datetimepicker({
            format: "yyyy-mm-dd",
            minView: "month",
            autoclose: true
        });
    });

    $(function(){
        $.fn.autoHeight = function(){
            function autoHeight(elem){
                elem.style.height = 'auto';
                elem.scrollTop = 0; //防抖动
                elem.style.height = elem.scrollHeight + 'px';
            }
            this.each(function(){
                autoHeight(this);
                $(this).on('keyup', function(){
                    autoHeight(this);
                });
            });
        }
        $('textarea[autoHeight]').autoHeight();
    })

    //自动填充个人信息
    $(function () {
        $.ajax({
            type: "POST",
            url: prefix + "/getMessage/",
            dataType: 'json',
            success: function(result) {
                if (result.code == 0) {
                    $('#dept').val(result.data.dept);
                    $("#applyname").val(result.data.applyname);
                    //$("#company").val(result.data.company);
                   var com=result.data.company;
                    //自动带出公司
                    if (com=="杭州") {
                        $("#company").val("5");
                    }else if (com=="西安"||com=="西安，驻厂") {
                        $("#company").val("7");
                    }else if (com=="成都") {
                        $("#company").val("17");
                    }else if (com=="上海"||com=="浦东"||com=="浦西") {
                        $("#company").val("19");
                    }else if (com=="韩国") {
                        $("#company").val("3");
                    }else if (com=="印度") {
                        $("#company").val("16");
                    }else if (com=="日本") {
                        $("#company").val("15");
                    }else if (com=="台湾"||com=="台北"||com=="高雄"||com=="新竹") {
                        $("#company").val("12");
                    }else if (com=="南京"||com=="无锡"||com=="武汉"||com=="江阴"||com=="苏州"||com=="长沙") {
                        $("#company").val("6");
                    }else if (com=="香港") {
                        $("#company").val("13");
                    }else if (com=="上海矽力杰微电子") {
                        $("#company").val("14");
                    } else if (com=="南京香港") {
                        $("#company").val("20");
                    }else if (com=="US-CA IRVINE"||com=="US-CA Sunnyvale"||com=="US-CA Sunnyvale / 高雄"||com=="US-HOME MO;St.Louis Missouri"||com=="US-NC Cary") {
                        $("#company").val("4");
                    }else if (com=="萨摩亚") {
                        $("#company").val("9");
                    } else if (com=="corp") {
                        $("#company").val("1");
                    } else if (com=="矽望") {
                        $("#company").val("21");
                    } else if (com=="澳门") {
                        $("#company").val("23");
                    }else{
                        $("#company").val("0");
                    }
                    //财务总账赋值
                    var company=$("#company").val();
                    if (company=="5"){
                        $("#fc").val("1");
                    }else if (company=="7") {
                        $("#fc").val("2");
                    }else if (company=="17"||company=="19"||company=="3") {
                        $("#fc").val("3");
                    }else if (company=="4"||company=="9"||company=="16"||company=="13"||company=="15") {
                        $("#fc").val("4");
                    }else if (company=="12") {
                        $("#fc").val("5");
                    }else if (company=="6"||company=="14") {
                        $("#fc").val("6");
                    }else if (company=="20") {
                        $("#fc").val("7");
                    }else if (company=="1"||company=="21") {
                        $("#fc").val("8");
                    }
                    //若选其他  暂由杭州负责
                    else{
                        $("#fc").val("1");
                    }

                    //印章类型显示
                    if (company=="5") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="12") {
                        $("#1").hide();
                        $("#2").hide();
                        $("#3").hide();
                        $("#4").show();
                        $("#5").show();
                        $("#6").show();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="6") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="20") {
                        $("#1").hide();
                        $("#2").show();
                        $("#3").hide();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").show();
                        $("#8").show();
                    }else if (company=="2") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="17") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="22") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    } else if (company=="23") {
                        $("#1").show();
                        $("#2").hide();
                        $("#3").hide();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }

                    //抬头自动更换
                    if (company=="5"){
                     $(".my-h2").html("矽力杰半导体技术（杭州）有限公司")
                    }else if (company=="7") {
                        $(".my-h2").html("西安矽力杰半导体技术有限公司")
                    }else if (company=="17") {
                        $(".my-h2").html("成都矽力杰半导体技术有限公司")
                    }else if (company=="19") {
                        $(".my-h2").html("上海矽力杰半导体技术有限公司")
                    }else if (company=="3") {
                        $(".my-h2").html("Silergy Korea Limited")
                    }else if (company=="16") {
                        $(".my-h2").html("Silergy Technologies Private Limited")
                    }else if (company=="15") {
                        $(".my-h2").html("Silergy Semiconductor Samoa Limited")
                    } else if (company=="12") {
                        $(".my-h2").html("台湾矽力杰科技股份有限公司")
                    }else if (company=="6") {
                        $(".my-h2").html("南京矽力微电子技术有限公司")
                    }else if (company=="13") {
                        $(".my-h2").html("Silergy Semiconductor (Hong Kong) Limited 矽力杰半導體(香港)有限公司")
                    }else if (company=="14") {
                        $(".my-h2").html("上海矽力杰微电子技术有限公司")
                    }else if (company=="20") {
                        $(".my-h2").html("南京矽力微電子(香港)有限公司")
                    }else if (company=="4") {
                        $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp Silergy Technology")
                    }else if (company=="9") {
                        $(".my-h2").html("Silergy Semiconductor (Samoa) Limited")
                    }else if (company=="1") {
                        $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Silergy Corp")
                    }else if (company=="21") {
                        $(".my-h2").html("Silicon Prospect Investment Limited")
                    }else if (company=="23") {
                        $(".my-h2").html("矽力杰半導體(澳門)一人有限公司")
                    }else{
                        $(".my-h2").html("南京矽力微电子技术有限公司")
                    }
                    $("#sid").val(result.data.sid);
                    $("#deptmanager").val(result.data.deptmanager);
                    $("#deptmanagerSid").val(result.data.deptmanagerSid);
                    //选择印章保存人
                    custodian();
                } else if(result.code == 404){
                    $.modal.alertError("获取失败");
                }else{
                    $('.departmentCode').val("");
                    $.modal.alertError("发送错误");
                }
            },
            error: function(error) {
                $.modal.alertWarning("");
            }
        });
    });
    
    $('#sid').on('blur',function () {
        debugger
        var sid=$(this).val();
        $.ajax({
            type: "GET",
            url: prefix + "/getMessage/"+sid,
            dataType: 'json',
            success: function(result) {
                if (result.code == 0) {
                    $('#dept').val(result.data.dept);
                    $("#applyname").val(result.data.applyname);
                    //$("#company").val(result.data.company);
                    var com=result.data.company;
                    //自动带出公司
                    if (com=="杭州") {
                        $("#company").val("1");
                    }else if (com=="西安"||com=="西安，驻厂") {
                        $("#company").val("2");
                    }else if (com=="成都") {
                        $("#company").val("3");
                    }else if (com=="上海"||com=="浦东"||com=="浦西") {
                        $("#company").val("4");
                    }else if (com=="韩国") {
                        $("#company").val("5");
                    }else if (com=="印度") {
                        $("#company").val("6");
                    }else if (com=="日本") {
                        $("#company").val("7");
                    }else if (com=="台湾"||com=="台北"||com=="高雄"||com=="新竹") {
                        $("#company").val("8");
                    }else if (com=="南京"||com=="无锡"||com=="武汉"||com=="江阴"||com=="苏州"||com=="长沙") {
                        $("#company").val("9");
                    }else if (com=="香港") {
                        $("#company").val("10");
                    }else if (com=="上海矽力杰微电子") {
                        $("#company").val("11");
                    } else if (com=="南京香港") {
                        $("#company").val("12");
                    }else if (com=="US-CA IRVINE"||com=="US-CA Sunnyvale"||com=="US-CA Sunnyvale / 高雄"||com=="US-HOME MO;St.Louis Missouri"||com=="US-NC Cary") {
                        $("#company").val("13");
                    }else if (com=="萨摩亚") {
                        $("#company").val("14");
                    } else if (com=="corp") {
                        $("#company").val("15");
                    } else if (com=="矽望") {
                        $("#company").val("16");
                    } else if (com=="澳门") {
                        $("#company").val("23");
                    }else{
                        $("#company").val("17");
                    }
                    //财务总账赋值
                    var company=$("#company").val();
                    if (company=="1"){
                        $("#fc").val("1");
                    }else if (company=="2") {
                        $("#fc").val("2");
                    }else if (company=="3"||company=="4"||company=="5") {
                        $("#fc").val("3");
                    }else if (company=="13"||company=="14"||company=="6"||company=="7"||company=="10") {
                        $("#fc").val("4");
                    }else if (company=="8") {
                        $("#fc").val("5");
                    }else if (company=="9"||company=="11") {
                        $("#fc").val("6");
                    }else if (company=="12") {
                        $("#fc").val("7");
                    }else if (company=="15"||company=="16") {
                        $("#fc").val("8");
                    }
                    //若选其他  暂由杭州负责
                    else{
                        $("#fc").val("1");
                    }

                    debugger
                    //印章类型显示
                    if (company=="1") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="8") {
                        $("#1").hide();
                        $("#2").hide();
                        $("#3").hide();
                        $("#4").show();
                        $("#5").show();
                        $("#6").show();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="9") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="12") {
                        $("#1").hide();
                        $("#2").show();
                        $("#3").hide();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").show();
                        $("#8").show();
                    }else if (company=="2") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="3") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="22") {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else if (company=="23") {
                        $("#1").show();
                        $("#2").hide();
                        $("#3").hide();
                        $("#4").hide();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }else {
                        $("#1").show();
                        $("#2").show();
                        $("#3").show();
                        $("#4").show();
                        $("#5").hide();
                        $("#6").hide();
                        $("#7").hide();
                        $("#8").hide();
                    }

                    //抬头自动更换
                    if (company=="5"){
                        $(".my-h2").html("矽力杰半导体技术（杭州）有限公司")
                    }else if (company=="7") {
                        $(".my-h2").html("西安矽力杰半导体技术有限公司")
                    }else if (company=="17") {
                        $(".my-h2").html("成都矽力杰半导体技术有限公司")
                    }else if (company=="19") {
                        $(".my-h2").html("上海矽力杰半导体技术有限公司")
                    }else if (company=="3") {
                        $(".my-h2").html("Silergy Korea Limited")
                    }else if (company=="16") {
                        $(".my-h2").html("Silergy Technologies Private Limited")
                    }else if (company=="15") {
                        $(".my-h2").html("Silergy Semiconductor Samoa Limited")
                    } else if (company=="12") {
                        $(".my-h2").html("台湾矽力杰科技股份有限公司")
                    }else if (company=="6") {
                        $(".my-h2").html("南京矽力微电子技术有限公司")
                    }else if (company=="13") {
                        $(".my-h2").html("Silergy Semiconductor (Hong Kong) Limited 矽力杰半導體(香港)有限公司")
                    }else if (company=="14") {
                        $(".my-h2").html("上海矽力杰微电子技术有限公司")
                    }else if (company=="20") {
                        $(".my-h2").html("南京矽力微電子(香港)有限公司")
                    }else if (company=="4") {
                        $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp Silergy Technology")
                    }else if (company=="9") {
                        $(".my-h2").html("Silergy Semiconductor (Samoa) Limited")
                    }else if (company=="1") {
                        $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Silergy Corp")
                    }else if (company=="21") {
                        $(".my-h2").html("Silicon Prospect Investment Limited")
                    }else if (company=="23") {
                        $(".my-h2").html("矽力杰半導體(澳門)一人有限公司")
                    }else{
                        $(".my-h2").html("南京矽力微电子技术有限公司")
                    }
                    $("#sid").val(result.data.sid);
                  /*  $("#deptmanager").val(result.data.deptmanager);*/
                } else if(result.code == 404){
                    $.modal.alertError("获取失败");
                }else{
                    $('.departmentCode').val("");
                    $.modal.alertError("发送错误");
                }
            },
            error: function(error) {
                $.modal.alertWarning("");
            }
        });
    })
    
    //类型显示
    $('#type').on('change',function () {
       var type=$(this).val();
        if (type=="1"){
            $("#hr").show();
            $("#topic1").hide();
            $("#topic2").hide();
            $("#exp1").show();
            $("#exp2").show();
            $("#seal3").show();
            $("#law1").show();
            $("#law2").show();
            $("#sealtype").show();
            $("#monery").hide();
            $("#curr").hide();
            $("#fcManager").hide();
            $("#cfcoManager").hide();
            $("#gmSta").show();
            $("#acoffer").hide();
            $("#nopt").hide();
            $("#addTrialColumn").hide();

        }else if (type=="2"){
            $("#hr").hide();
            $("#seal3").hide();
            $("#topic1").show();
            $("#topic2").show();
            $("#law1").hide();
            $("#law2").hide();
            $("#sealtype").hide();
            $("#monery").show();
            $("#curr").show();
            $("#fcManager").show();
            $("#cfcoManager").show();
            $("#gmSta").show();
            $("#acoffer").hide();
            $("#nopt").show();
            $("#addTrialColumn").show();

        }else if (type=="3"){
            $("#monery").hide();
            $("#curr").hide();
            $("#topic1").show();
            $("#topic2").show();
            $("#hr").hide();
            $("#seal3").hide();
            $("#law1").hide();
            $("#law2").hide();
            $("#sealtype").hide();
            $("#fcManager").hide();
            $("#cfcoManager").hide();
            $("#gmSta").show();
            $("#acoffer").show();
            $("#nopt").show();
            $("#addTrialColumn").show();
        }
    });

    $(function () {
        // $.modal.msg("请先选择签呈类型",modal_status.WARNING);
        layer.msg("请先选择签呈类型！", {
            icon: 0,
            time: 3000, //2秒关闭（如果不配置，默认是3秒）
        });

        //类型显示
       // $('#type').on('change',function () {
            var type=  $('#type').val();
            if (type=="1"){
                $("#hr").show();
                $("#topic1").hide();
                $("#topic2").hide();
                $("#exp1").show();
                $("#exp2").show();
                $("#seal3").show();
                $("#law1").show();
                $("#law2").show();
                $("#sealtype").show();
                $("#monery").hide();
                $("#curr").hide();
                $("#fcManager").hide();
                $("#cfcoManager").hide();
                $("#gmSta").show();
                $("#acoffer").hide();

            }else if (type=="2"){
                $("#hr").hide();
                $("#seal3").hide();
                $("#topic1").show();
                $("#topic2").show();
                $("#law1").hide();
                $("#law2").hide();
                $("#sealtype").hide();
                $("#monery").show();
                $("#curr").show();
                $("#fcManager").show();
                $("#cfcoManager").show();
                $("#gmSta").show();
                $("#acoffer").hide();

            }else if (type=="3"){
                $("#monery").hide();
                $("#curr").hide();
                $("#topic1").show();
                $("#topic2").show();
                $("#hr").hide();
                $("#seal3").hide();
                $("#law1").hide();
                $("#law2").hide();
                $("#sealtype").hide();
                $("#fcManager").hide();
                $("#cfcoManager").hide();
                $("#gmSta").show();
                $("#acoffer").hide();
            }


    })
    $('#moneyM').keyup(function(){
        var $this = $(this);
        var reg = /(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]{1,2}$)/;
        var val = $this.val();
        if(reg.test(val)){
            console.log('true')
        }else{
            // $this.val('')
            console.log('false')
            return false
        }
    });

    $('#moneyM').on('blur',function () {
        debugger
        var monery=$(this).val();
        var reg = new RegExp("((^[1-9]\\d*)|^0)(\\.\\d{0,2}){0,1}$");
        if(reg.test(monery)){
            console.log('true')
        }else{
            layer.msg("请输入正常金额");
            $(this).val('');
            $(this).focus();
        }
    });

    //进入页面自动带出印鉴保管人
    $(function () {
        var company=$("#company").val();
        if (company=="5"){
            $("#fc").val("1");
        }else if (company=="7") {
            $("#fc").val("2");
        }else if (company=="17"||company=="19"||company=="3") {
            $("#fc").val("3");
        }else if (company=="4"||company=="9"||company=="16"||company=="15"||company=="13") {
            $("#fc").val("4");
        }else if (company=="12") {
            $("#fc").val("5");
        }else if (company=="6"||company=="14") {
            $("#fc").val("6");
        }else if (company=="20") {
            $("#fc").val("8");
        }else if (company=="1") {
            $("#fc").val("9");
        }else if (company=="21") {
            $("#fc").val("1");
        }
    });
    //财务总账赋值
    $("#company").on('change',function () {
        var company=$("#company").val();
        if (company=="5"){
            $("#fc").val("1");
        }else if (company=="7") {
            $("#fc").val("2");
        }else if (company=="17") {
            $("#fc").val("3");
        }else if (company=="4"||company=="9"||company=="16"||company=="13"||company=="15"||company=="3") {
            $("#fc").val("4");
        }else if (company=="12") {
            $("#fc").val("5");
        }else if (company=="6") {
            $("#fc").val("6");
        }else if (company=="1"||company=="21") {
            $("#fc").val("8");
        }else if (company=="19") {
            $("#fc").val("9");
        }else if (company=="14"||company=="20") {
            $("#fc").val("10");
        }else if (company=="22") {
            $("#fc").val("11");
        }
        //若选其他  暂由杭州负责
        else{
            $("#fc").val("1");
        }
    });

    //财务经理赋值
    $("#company").on('change',function () {
        var company=$("#company").val();
        if (company=="14"||company=="20"||company=="6") {
            $("#cfco").val("3");
        } else{
            $("#cfco").val("2");
        }
    });



    $("#company").on('change',function () {
        var company=$(this).val();
        //抬头自动更换
        if (company=="5"){
            $(".my-h2").html("矽力杰半导体技术（杭州）有限公司")
        }else if (company=="7") {
            $(".my-h2").html("西安矽力杰半导体技术有限公司")
        }else if (company=="17") {
            $(".my-h2").html("成都矽力杰半导体技术有限公司")
        }else if (company=="19") {
            $(".my-h2").html("上海矽力杰半导体技术有限公司")
        }else if (company=="3") {
            $(".my-h2").html("Silergy Korea Limited")
        }else if (company=="16") {
            $(".my-h2").html("Silergy Technologies Private Limited")
        }else if (company=="15") {
            $(".my-h2").html("Silergy Semiconductor Samoa Limited")
        } else if (company=="12") {
            $(".my-h2").html("台湾矽力杰科技股份有限公司")
        }else if (company=="6") {
            $(".my-h2").html("南京矽力微电子技术有限公司")
        }else if (company=="13") {
            $(".my-h2").html("Silergy Semiconductor (Hong Kong) Limited 矽力杰半導體(香港)有限公司")
        }else if (company=="14") {
            $(".my-h2").html("上海矽力杰微电子技术有限公司")
        }else if (company=="20") {
            $(".my-h2").html("南京矽力微電子(香港)有限公司")
        }else if (company=="4") {
            $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp Silergy Technology")
        }else if (company=="9") {
            $(".my-h2").html("Silergy Semiconductor (Samoa) Limited")
        }else if (company=="1") {
            $(".my-h2").html(" &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Silergy Corp")
        }else if (company=="21") {
            $(".my-h2").html("Silicon Prospect Investment Limited")
        }else if (company=="22") {
            $(".my-h2").html("合肥矽力杰半导体技术有限公司")
        }else if (company=="23") {
            $(".my-h2").html("矽力杰半導體(澳門)一人有限公司")
        }else{
            $(".my-h2").html("南京矽力微电子技术有限公司")
        }
        custodian();
    });
    //根据所选印章类型和地区自动带出印章保管人
    $('input[name=sealType]').click(custodian);

    //判断印章保管人
    function custodian() {
        debugger
        var seal=$('input[name=sealType]:checked').val();
        var company=$('#company').val();
        if (company=="5"&&seal=="1"){
            $("#hr1").val("2");
        }else if (company=="5"&&seal=="2") {
            $("#hr1").val("1");
        }else if (company=="5"&&seal=="3") {
            $("#hr1").val("3");
        }else if (company=="5"&&seal=="4") {
            $("#hr1").val("2");
        }else if (company=="12"&&seal=="4") {
            $("#hr1").val("4");
        }else if (company=="12"&&seal=="5") {
            $("#hr1").val("2");
        }else if (company=="12"&&seal=="6") {
            $("#hr1").val("5");
        }else if (company=="6"&&seal=="1") {
            $("#hr1").val("6");
        }else if (company=="6"&&seal=="4") {
            $("#hr1").val("6");
        }else if (company=="6"&&seal=="2") {
            $("#hr1").val("6");
        }else if (company=="6"&&seal=="3") {
            $("#hr1").val("9");
        }else if (company=="12"&&seal=="7") {
            $("#hr1").val("6");
        }else if (company=="20"&&seal=="8") {
            $("#hr1").val("6");
        }else if (company=="20"&&seal=="2") {
            $("#hr1").val("8");
        }else if (company=="7"&&seal=="3") {
            $("#hr1").val("7");
        }else if (company=="7"&&seal=="2") {
            $("#hr1").val("10");
        }else if (company=="7"&&seal=="1") {
            $("#hr1").val("11");
        }else if (company=="17"&&seal=="3") {
            $("#hr1").val("7");
        }else if (company=="17"&&seal=="2") {
            $("#hr1").val("13");
        }else if (company=="17"&&seal=="1") {
            $("#hr1").val("14");
        } else if (company=="1"&&seal=="1") {
            $("#hr1").val("2");
        }else  if (company=="22"&&seal=="1") {
            $("#hr1").val("20");
        }else  if (company=="22"&&seal=="2") {
            $("#hr1").val("20");
        }else  if (company=="22"&&seal=="3") {
            $("#hr1").val("21");
        }else  if (company=="23"&&seal=="1") {
            $("#hr1").val("22");
        }else{
            $("#hr1").val("");
        }
    }

    $('#company').on('change',function () {
        var company=$(this).val();
        if (company=="5") {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").show();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="12") {
            $("#1").hide();
            $("#2").hide();
            $("#3").hide();
            $("#4").show();
            $("#5").show();
            $("#6").show();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="6") {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").show();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="20") {
            $("#1").hide();
            $("#2").show();
            $("#3").hide();
            $("#4").hide();
            $("#5").hide();
            $("#6").hide();
            $("#7").show();
            $("#8").show();
        }else if (company=="7") {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").hide();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="17") {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").hide();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="22") {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").hide();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else if (company=="23") {
            $("#1").show();
            $("#2").hide();
            $("#3").hide();
            $("#4").hide();
            $("#5").hide();
            $("#6").hide();
            $("#7").hide();
            $("#8").hide();
        }else {
            $("#1").show();
            $("#2").show();
            $("#3").show();
            $("#4").show();
            $("#5").show();
            $("#6").show();
            $("#7").show();
            $("#8").show();
        }
    });

    getUser();
    function getUser(){
        var url = ctx + "system/user/allUserList";
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            url: url,//url
            data: null,
            contentType: "application/json; charset=utf-8",
            dataType: "json",//预期服务器返回的数据类型
            // timeout: 60000,
            success: function (result) {
                if (result.code == web_status.SUCCESS){
                    var rows = result.rows;
                    rows.forEach(user=> {
                        $("#addname").append($("<option></option>").html(user.userName).val(user.userCode));
                    });
                    rows.forEach(user=> {
                        $("#addTrialName").append($("<option></option>").html(user.userName).val(user.userCode));
                    });
                    rows.forEach(user=> {
                        $("#gmSid").append($("<option></option>").html(user.userName).val(user.userCode));
                    });
                    rows.forEach(user=> {
                        $("#acOfficerSid").append($("<option></option>").html(user.userName).val(user.userCode));
                    });
                    //刷新
                    $("#addname").selectpicker("refresh");
                    $("#addTrialName").selectpicker("refresh");
                    $("#gmSid").selectpicker("refresh");
                    $("#acOfficerSid").selectpicker("refresh");
                }
            }
        });
    }

    //自动填充时间
    $(function () {
        function f() {
            var now = new Date();
            var year = now.getFullYear();       //年
            var month = now.getMonth() + 1;     //月
            var day = now.getDate();            //日
            var clock = year + "-";
            if(month < 10)
                clock += "0";
            clock += month + "-";
            if(day < 10)
                clock += "0";
            clock += day + "";
            return clock;
        }
        $(".nowdate").val(f());
    });

    function nameData(){
        $.get(ctx + "system/petition/getAlluser", function(data){
            debugger

            $(".name-data").typeahead({
                source: data.value
            });
        },'json');
    }


    //添加核审人一行
    function add(){
        $('.addname').selectpicker('destroy');
        var $td = $("#addColumn").clone();       //增加一行,克隆第一个对象
        $(".my-table2").append($td);
        $(".my-table2 tr:last").find(":input").val('');   //将尾行元素克隆来的保存的值清空
        $('.addname').selectpicker();
    };
    //添加会审人一行
    function addTrial(){
        $('.addTrialName').selectpicker('destroy');
        var $td = $("#addTrialColumn").clone(true,false);
        //增加一行,克隆第一个对象
        $(".my-table-trial").append($td);
        $(".my-table-trial tr:last").find(":input").val('');   //将尾行元素克隆来的保存的值清空
        $('.addTrialName').selectpicker();
    };

    //删除行
    $(document).on("click", ".operate-tr1", function(){
        debugger
        var n = $(this).parents("tr").index();  // 获取checkbox所在行的顺序
        var total = $(".my-table2").children("tr").length; //获取tr个数
        if(total < 2){
            $.modal.alertError("必须保留一行");
            return false;
        }else{
            $(".my-table2").find("tr:eq("+n+")").remove();
        }
    });

    //删除会审一行
    $(document).on("click", ".operate-tr-trial", function () {
        debugger
        var n = $(this).parents("tr").index();  // 获取checkbox所在行的顺序
        var total = $(".my-table-trial").children("tr").length; //获取tr个数
        if (total < 2) {
            $.modal.alertError("必须保留一行！");
            return false;
        } else {
            $(".my-table-trial").find("tr:eq(" + n + ")").remove();
        }
    })


    var prefix = ctx + "system/petition";
    var comprefix = ctx + "common/"
    $("#form-petition-add").validate({
        rules:{
            xxxx:{
                required:true,
            },
        },
        focusCleanup: true
    });

    /*function submit(id) {
        $.modal.confirm("确定提交吗？", function() {
            submitHandler();
            $.ajax({
                //几个参数需要注意一下
                type: "GET",//方法类型
                url: prefix + "/submit?id=" + id,//url
                dataType: "json",//预期服务器返回的数据类型
                beforeSend: function () {
                    $.modal.loading("正在给相关人员发送邮件,请稍等......");
                },
                success: function (result) {
                    $.operate.successCallback(result);
                },
                error : function() {
                    alert("error！");
                }
            });
        })
    };*/

    function submitHandler() {
        var type=$("#type").val();
        if (type=="1"){
            //财务总账为空
            $("#fc").val("");
            //财务经理为空
            $("#cfco").val("");
            //c类审核人为空
            $("#acOfficer").val("");
            //会审人为空
            $("#addTrialName").val("");
            //金额为空
            $("#moneyM").val("");
            //支付币种为空
            $('[name="curr"]:checked').val("");
        }else if (type=="2"){
            //印鉴保管人为空
            $("#hr1").val("");
            //法务为空
            $("#law").val("");
            //c类审核人为空
            $("#acOfficer").val("");
            //印章为空
            $('[name="sealType"]').val("");
            //印章使用说明为空
            $('[name="sealExplain"]').val("");
            //印章使用日期为空
            $('[name="sealDate"]').val("");
            //印章其他为空
            $('[name="seal"]').val("");
        }else if (type=="3"){
            //印鉴保管人为空
            $("#hr1").val("");
            //法务为空
            $("#law").val("");
            //财务总账为空
            $("#fc").val("");
            //财务经理为空
            $("#cfco").val("");
            //金额为空
            $("#moneyM").val("");
            //支付币种为空
            $('[name="curr"]:checked').val("");
            //印章为空
            $('[name="sealType"]').val("");
            //印章使用说明为空
            $('[name="sealExplain"]').val("");
            //印章使用日期为空
            $('[name="sealDate"]').val("");
            //印章其他为空
            $('[name="seal"]').val("");
        }
        
        if ($.validate.form()) {
            debugger
            var Object = {};
            var formObject = {};
            var formArray = $("#form-petition-add").serializeArray();
            $.each(formArray, function (i, item) {
                formObject[item.name] = item.value;
            });
            if (formObject.typeType == 1) {
                if (formObject.explanation == "") {
                    $.modal.alertWarning("请输入说明");
                    return false;
                }
                if (formObject.sealType == "") {
                    $.modal.alertWarning("请选择使用印鉴");
                    return false;
                }
                if (formObject.law == "") {
                    $.modal.alertWarning("请选择是否走法务");
                    return false;
                }
                if (formObject.department == "") {
                    $.modal.alertWarning("请选择是否走部门主管");
                    return false;
                }
                if (formObject.hr == "" || formObject.hr == undefined) {
                    $.modal.alertWarning("请选择印鉴保管人");
                    return false;
                }
                if (formObject.sealExplain == "2" && formObject.sealDate == "") {
                    $.modal.alertWarning("请选择外借日期");
                    return false;
                }

            }
            ;
            if (formObject.typeType == 2) {
                if (formObject.topicObj == "") {
                    $.modal.alertWarning("请输入主题内容");
                    return false;
                }
                ;
                if (formObject.explanation == "") {
                    $.modal.alertWarning("请输入说明");
                    return false;
                }
                ;
                if (formObject.moneyM == "") {
                    $.modal.alertWarning("请输入金额");
                    return false;
                }
                // if (formObject.curr == "") {
                //     $.modal.alertWarning("请输入币别");
                //     return false;
                // }
                // if (formObject.fcManager == "") {
                //     $.modal.alertWarning("请选择财务总账");
                //     return false;
                // }
            }
            if (formObject.typeType == 3) {
                /*if (formObject.acOfficer == "") {
                    $.modal.alertWarning("请输入核准人");
                    return false;
                }*/
                if (formObject.topicObj == "") {
                    $.modal.alertWarning("请输入主题内容");
                    return false;
                }
                ;
                if (formObject.explanation == "") {
                    $.modal.alertWarning("请输入说明");
                    return false;
                }
            }
            var petitionSignList = [];
            var flag = true;
            $(".addaudit").each(function (i, li) {
                i = i + 1;
                var aud = {};
                var  sid=$(li).find("select[id='addname']").val();
                if (sid != "") {
                    // $.modal.alertWarning("请输入第" + i + "行的姓名");
                    // flag = false;
                    aud.sid = sid;
                    petitionSignList.push(aud);
                };
            });

            if (flag == false) {
                $.modal.alertWarning("核准人不能为空");
                return false;
            }
            Object.petition = formObject;
            Object.petitionSignList = petitionSignList;
debugger
            //添加会审人放进列表
            var petitionTrialList = [];
            var flag = true;
            $(".addtrial").each(function (i, li) {
                i = i + 1;
                var aud = {};
                var  sid=$(li).find("select[id='addTrialName']").val();
                if (sid != "") {
                    // $.modal.alertWarning("请输入第" + i + "行的姓名");
                    // flag = false;
                    aud.sid=sid.toString();
                    petitionTrialList.push(aud);
                };
            });

            if (flag == false) {
                $.modal.alertWarning("会审人不能为空");
                return false;
            }
            Object.petitionTrialList = petitionTrialList;
            
            console.log(Object);

            // Object.petition.sealType = $.form.selectCheckeds("sealType");
            $.modal.confirm("确定要提交吗?", function () {
                debugger
                {
                    $.ajax({
                        type: "POST",
                        url: prefix + "/add",
                        data: JSON.stringify(Object),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",//预期服务器返回的数据类型
                        timeout: 100000,
                        beforeSend: function () {
                            $.modal.loading("正在给相关人员发送邮件,请稍等......");
                        },
                        success: function (result) {
                            debugger
                            if (result.code == web_status.SUCCESS) {
                                if ($('#file')[0].files[0] != null) {
                                    var formData = new FormData();
                                    formData.append('id', result.msg); //id
                                    var filrarr = document.getElementById("file").files;
                                    for (var i = 0; i < filrarr.length; i++) {
                                        formData.append("files", filrarr[i]);
                                        formData.append("parentId", result.msg);
                                        formData.append("type", 3);
                                    }
                                    $.ajax({
                                        url: comprefix + "/uploadFiles",
                                        type: 'post',
                                        cache: false,
                                        data: formData,
                                        processData: false,
                                        contentType: false,
                                        dataType: "json",
                                        async: false,//改成同步
                                        success: function (result) {
                                            if (result.code == web_status.SUCCESS) {
                                                result.msg = "操作成功！";
                                                $.operate.successTabCallback(result);
                                            } else {
                                                $.modal.closeLoading();
                                                $.modal.alertError(result.msg);
                                            }
                                        }
                                    });
                                } else {
                                    if (result.code == web_status.SUCCESS) {
                                        result.msg = "操作成功！";
                                        $.operate.successTabCallback(result);
                                    } else {
                                        $.modal.closeLoading();
                                        $.modal.alertError(result.msg);
                                    }
                                }
                            }else {
                                $.modal.closeLoading();
                                $.modal.alertError(result.msg);
                            }

                            if (result.code == 404) {
                                $.modal.alertWarning("获取用户失败,请根据提示输入核准人名称");
                                $.modal.closeLoading();
                                return false;
                            }
                            $.modal.closeLoading();
                            $.modal.alertError(result.msg);
                        },
                        error: function () {
                            alert("error");
                        }
                    })
                };
            });
        }
    }
</script>
<style>
    .table>thead>tr>th, .table>tbody>tr>th, .table>tfoot>tr>th, .table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td{
        line-height: 1 !important;
    }
    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
        padding: 3px 0 3px 4px !important;

    }
    .wrapper{
        /*text-align: center; !*让div内部文字居中*!*/
        margin: auto;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 1050px;
        height: auto;
        /*width: 1050px;*/

        /*border:1px solid #000*/
    }
    .my-table{
        margin-left: auto;
        margin-right: auto;
        /*margin-top: 1px;*/
        /*margin-bottom: 1px;*/
    }
    .my-table1 tr td{
        border:none;
    }
    .bottom{
        margin-top: 10px;
    }
    .form-control {
        border: 0;
        webkit-box-shadow: none;
        box-shadow: none;
        background-color: #FFFFF4;
    }
    table td{
        border: 1px solid #000;
    }
    .my-h2{
        margin: auto;
    }
    .my-h3{
        margin-left: 80px;



    }
    #for-boder{
        border:1px double #000;
        width: 70%;
        margin-left: 100px;
    }
    #for-boder1{
        width: 70%;
        margin-left: 100px;
    }
    .container{
        margin-left: 10%;
    }
    input[type=checkbox], input[type=radio] {
        margin: 0px 0 0;
        margin-top: 1px\9;
        line-height: normal;
    }
    body{
        overflow: scroll;
    }
    .name-data-position{
        position: relative;
    }
</style>
</body>
</html>
