<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head >
    <th:block th:include="include :: header('')" />
    <th:block th:include="include :: layout-latest-css" />
</head>
<body class="gray-bg">

<div class="container-div">
    <div class="row">
        <div class="col-sm-12 search-collapse">
            <form id="formId">
                <div class="select-list">
                    <ul>
                        <li>
                            Payment Request No：<input type="text" name="paymentRequestNo"/>
                        </li>
                        <li>
                            Applicant：<input type="text" name="applicant"/>
                        </li>
                        <li>
                            Employee No：<input type="text" name="employeeNo"/>
                        </li>
                        <li>
                            Dept：<input type="text" name="dept"/>
                        </li>
                        <li>
                            Dept Code：<input type="text" name="deptCode"/>
                        </li>
                        <li>
                            Company：
                            <select name="company">
                                <option value="">ALL</option>
                                <option value="6">南京</option>
                                <option value="14">上海矽力杰微电子</option>
                                <option value="20">南京香港</option>
                            </select>
                        </li>
                        <li>
                            Payment Type：<select name="paymentType">
                            <option value="">ALL</option>
                            <option value="X">个人报销</option>
                            <option value="B">非生产性支出-持续性</option>
                            <option value="C">非生产性支出-非持续性</option>
                            <option value="E">交际费</option>
                        </select>
                        </li>
                        <li>
                            Payee：<input type="text" name="payee"/>
                        </li>
                        <li>
                            <input id="paymentAmount" type="text" name="paymentAmount" hidden/>
                            Payment Amount：<input type="text" id="paymentAmount1" name="paymentAmount1"/>
                        </li>
                        <li>
                            Status：
                            <select name="status">
                                <option value="">ALL</option>
                                <option value="1">已保存待提交</option>
                                <option value="2">待主管审批</option>
                                <option value="3">待经理审批</option>
                                <option value="4">待总监审批</option>
                                <option value="6">待执行总监审批</option>
                                <option value="8">待总经理审批</option>
                                <option value="5">待财务初核</option>
                                <option value="7">待总账审批</option>
                                <option value="21">完成</option>
                                <option value="20">撤回</option>
                                <option value="22">保留</option>
                                <option value="19">否决</option>
                            </select>
                        </li>
                        <li>
                            <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                            <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                        </li>
                    </ul>
                </div>
            </form>
        </div>

        <div class="btn-group-sm" id="toolbar" role="group">
            <a class="btn btn-success" onclick="batchUploadScreenshots()" shiro:hasPermission="system:paymentRequest:finance">
                <i class="fa fa-upload"></i> 批量上传审批截图
            </a>
        </div>
        <div class="col-sm-12 select-table table-striped">
            <table id="bootstrap-table" data-mobile-responsive="true"></table>
        </div>
    </div>
</div>
<div th:include="include :: footer"></div>
<script th:src="@{/ajax/libs/report/peity/jquery.peity.min.js}"></script>
<script th:inline="javascript">
    var editFlag = [[${@permission.hasPermi('system:paymentRequest:edit')}]];
    var removeFlag = [[${@permission.hasPermi('system:paymentRequest:remove')}]];
    var prefix = ctx + "system/paymentRequest";

    $(function() {
        var options = {
            url: prefix + "/list/do",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            exportUrl: prefix + "/export",
            modalName: "请款",
            showExport: false,
            mobileResponsive: true,
            clickToSelect: true,
            sortName: "updateTime",
            sortOrder: "desc",
            onLoadSuccess: onLoadSuccess,
            columns: [
                {
                    checkbox: true
                },
                {
                    field: 'id',
                    title: 'id',
                    visible: false
                },
                {
                    field: 'paymentRequestNo',
                    title: 'Payment Request No',
                    align: 'left',
                    sortable: true,
                },
                {
                    field: 'applicant',
                    title: 'Applicant',
                    align: 'left',
                },
                {
                    field: 'employeeNo',
                    title: 'Employee No',
                    align: 'left',
                },
                {
                    field: 'dept',
                    title: 'Dept',
                    align: 'left',
                },
                {
                    field: 'deptCode',
                    title: 'Dept Code',
                    align: 'left',
                },
                {
                    field: 'applicationDate',
                    title: 'Application Date',
                    align: 'left',
                    sortable: true,
                },
                {
                    field: 'remark',
                    title: 'Currency',
                    align: 'left',
                    formatter: function (value, row, index) {
                        return currency(value);
                    }
                },
                {
                    field: 'payee',
                    title: 'Payee',
                    align: 'left',
                    formatter: function(value, row, index) {
                        return $.table.tooltip(value,10);
                    }
                },
                {
                    field: 'paymentAmount',
                    title: 'Payment Amount',
                    align: 'left',
                    sortable: true,
                    // formatter: function (row) {
                    //     return (parseInt(row) / 100).toFixed(2);
                    // }
                },
                {
                    title: 'File',
                    align: 'left',
                    formatter: function (value, row, index) {
                        var actions = [];
                        var status = row.status;
                        var flag = false;
                        if (status == 1 || status == 7 || status == 13 || status == 20){
                            flag = true;
                        }
                        actions.push('<a class="btn btn-info btn-xs " href="javascript:void(0)" onclick="fileList(\'' + row.id + '\',' + flag + ')"><i class="fa fa-list-ul"></i> 列表</a>');
                        return actions.join('');
                    }
                },
                {
                    field: 'status',
                    title: 'Status',
                    align: 'left',
                    sortable: true,
                    formatter: function (value, row, index) {
                        return statusTools(row);
                    }
                },
                {
                    field: 'searchValue',
                    title: 'To',
                    align: 'left',
                },
                {
                    field: 'updateBy',
                    title: '',
                    align: 'center',
                    formatter: function (value, row, index) {
                        var val = '<span class="pie">' + value + '</span>';
                        return val;
                    },
                },
                {
                    field: 'progressRate',
                    title: '进度',
                    align: 'left',
                    formatter: function (value, row, index) {
                        var val = '<span class="pie">' + value + '</span>';
                        return val;
                    },
                },
                {
                    title: 'Operate',
                    align: 'left',
                    formatter: function(value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-warning btn-xs" href="#" onclick="detail(\'' + row.id + '\')"><i class="fa fa-search"></i> 详情</a> ');
                        return actions.join('');
                    }
                }]
        };
        $.table.init(options);
    });

    function onLoadSuccess(data) {
        $(".pie").peity("pie", {
            fill: ['#1ab394', '#d7d7d7', '#ffffff'],
        })
    }

    $('#paymentAmount1').on('blur',function(){
        var val = $(this).val();
        var reg = /^\d+(\.\d+)?$/;
        //是否是数字(包含小数点)
        if (reg.test(val) == true) {
            var paymentAmount = (parseFloat(val) * 100).toFixed(0);
            $("#paymentAmount").val(paymentAmount);
        } else {
            //不符合规格则清空输入框(这是我v-model的值)
            $(this).val("");
        }
    })

    function fileList(id, flag) {
        var url = prefix + '/filePage/' + id + '/'+1+'/' + flag ;
        $.modal.openFileList("File列表", url, null, null);
    }

    function batchUploadScreenshots() {
        table.set();
        var rows = $.common.isEmpty(table.options.uniqueId) ? $.table.selectFirstColumns() : $.table.selectColumns(table.options.uniqueId);
        if (rows.length == 0) {
            $.modal.alertWarning("请至少选择一条记录");
            return;
        }
        $.modal.confirm("确认要对选中的" + rows.length + "条数据执行关闭操作吗?", function () {
            var paymentRequestId = rows.join();
            var url = prefix + '/addClosePaymentRequestFile/' + paymentRequestId;
            $.modal.open("上传文件", url, 500, 300);
        });
    }

    function currency(value) {
        if (value == 1) {
            return 'RMB'
        } else if (value == 2){
            return 'USD'
        } else if (value == 3){
            return 'TWD'
        } else if (value == 4){
            return 'HKD'
        } else if (value == 5){
            return 'KRW'
        } else if (value == 6){
            return 'MOP'
        } else if (value == 7){
            return 'EUR'
        }
    }

    function detail(id) {
        // type:1 详情页 type:2 打印页面
        var url = prefix + "/detail/" + id + "/" + 1;
        createMenuItem(url, "详情");
    }

    /* 状态显示 */
    function statusTools(row) {
        if (row.status == 1) {
            return '已保存待提交'
        } else if (row.status == 2){
            return '待主管审核'
        } else if (row.status == 3){
            return '待经理审核'
        }else if (row.status == 4){
            return '待总监审核'
        }else if (row.status == 6){
            return '待执行总监审核'
        }else if (row.status == 8){
            return '待总经理审核'
        } else if(row.status == 5){
            return '财务初核'
        }else if(row.status == 7){
            return '总账确认'
        }else if(row.status == 18){
            return '待前加签审批'
        }else if(row.status == 23){
            return '待后加签审批'
        }else if(row.status == 19){
            return '否决'
        }else if(row.status == 20){
            return '撤回'
        }else if(row.status == 21){
            return '完成'
        }else if(row.status == 22){
            return '保留'
        }
    }
</script>
</body>
</html>