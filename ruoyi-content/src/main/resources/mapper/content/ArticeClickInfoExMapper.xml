<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.ruoyi.content.mapper.ArticeClickInfoExMapper">
 <resultMap id="BaseResultMap" type="com.ruoyi.content.domain.ClickTrackInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri May 25 15:02:37 CST 2018.
    -->
    <id column="CLICK_ID" property="clickId" jdbcType="VARCHAR" />
    <result column="PARENT_CLICK_ID" property="parentClickId" jdbcType="VARCHAR" />
    <result column="CLICK_OPEN_ID" property="clickOpenId" jdbcType="VARCHAR" />
    <result column="CLICK_USER_NICKNAME" property="clickUserNickname" jdbcType="VARCHAR" />
    <result column="CLICK_USER_HEADIMGURL" property="clickUserHeadimgurl" jdbcType="VARCHAR" />
    <result column="PUBLISH_USER_ID" property="publishUserId" jdbcType="VARCHAR" />
    <result column="ARTICLE_ID" property="articleId" jdbcType="VARCHAR" />
    <result column="CLICK_USER_ID" property="clickUserId" jdbcType="VARCHAR" />
    <result column="AD_ID" property="adId" jdbcType="VARCHAR" />
    <result column="FROM_SHARE_STATE" property="fromShareState" jdbcType="VARCHAR" />
    <result column="SHARE_STATE" property="shareState" jdbcType="VARCHAR" />
    <result column="WATCH_TIME" property="watchTime" jdbcType="VARCHAR" />
    <result column="CLICK_USER_INFO" property="clickUserInfo" jdbcType="LONGVARCHAR" />
    <result column="CREATE_DATE" property="createDate" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
    <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
    <result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR" />
    <result column="UPDATE_DATE" property="updateDate" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="VARCHAR" />
  </resultMap>
  
	<resultMap id="Map"
		type="com.ruoyi.content.domain.ArticeClickInfoExDTO">
		<result column="CLICK_USER_NICKNAME" property="clickUserNickname"
			jdbcType="VARCHAR" />
		<result column="CLICK_USER_HEADIMGURL" property="clickUserHeadimgurl"
			jdbcType="VARCHAR" />
		<result column="WATCH_TIME" property="watchTime" jdbcType="VARCHAR" />
		<result column="CREATE_DATE" property="createDate" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
		<result column="SHARE_STATE" property="shareState" jdbcType="VARCHAR" />
		<result column="FROM_SHARE_STATE" property="fromShareState"
			jdbcType="VARCHAR" />
		<result column="ARTICLE_ID" property="articleId" jdbcType="VARCHAR" />
		<result column="ARTICLE_NAME" property="articleName" jdbcType="VARCHAR" />
		<result column="PUSH_DATE" property="pushDate" jdbcType="VARCHAR" />
		<result column="ARTICLE_AUTHOR" property="articleAutchor"
			jdbcType="VARCHAR" />
		<result column="CLICK_USER_INFO" property="clickUserInfo"
			jdbcType="VARCHAR" />
		<result column="CLICK_ID" property="clickId"
			jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="ArticleInfoResultMap"
		type="com.ruoyi.content.domain.ArticleinfoExDTO">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Mar 29 
			09:44:12 CST 2018. -->
		<id column="ARTICLE_ID" property="articleId" jdbcType="INTEGER" />
		<result column="ARTICLE_NAME" property="articleName" jdbcType="VARCHAR" />
		<result column="PUSH_DATE" property="pushDate" jdbcType="VARCHAR" />
		<result column="ARTICLE_AUTHOR" property="articleAuthor"
			jdbcType="VARCHAR" />
		<result column="LIST_PIC_URL" property="listPicUrl" jdbcType="VARCHAR" />
		<result column="SPECIAL" property="special" jdbcType="VARCHAR" />
		<result column="CHANNEL_ID" property="channelId" jdbcType="VARCHAR" />
		<result column="COMPANY_ID" property="companyId" jdbcType="VARCHAR" />
		<result column="ORIGINAL_URL" property="originalUrl" jdbcType="VARCHAR" />
		<result column="SHARE_IMG_URL" property="shareImgUrl" jdbcType="VARCHAR" />
		<result column="SHARE_TITLE" property="shareTitle" jdbcType="VARCHAR" />
		<result column="ARTICLE_STATE" property="articleState"
			jdbcType="VARCHAR" />
		<result column="SHARE_DES" property="shareDes" jdbcType="VARCHAR" />
		<result column="CREATE_DATE" property="createDate" jdbcType="VARCHAR" />
		<result column="CREATE_TIME" property="createTime" jdbcType="VARCHAR" />
		<result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
		<result column="UPDATE_DATE" property="updateDate" jdbcType="VARCHAR" />
		<result column="UPDATE_TIME" property="updateTime" jdbcType="VARCHAR" />
		<result column="ARTICLE_CONTENT" property="articleContent"
			jdbcType="VARCHAR" />

		<result column="SHARECOUNT" property="shareCount" jdbcType="INTEGER" />
		<result column="WATCHCOUNT" property="visitors" jdbcType="INTEGER" />
		<result column="PUBLISH_VIEW_URL" property="publishViewUrl" jdbcType="INTEGER" />
		<result column="PUBLISH_EDIT_URL" property="publishEditUrl" jdbcType="INTEGER" />

	</resultMap>
	<select id="queryClerkArticleInfo" resultMap="Map">
		SELECT
		t2.CLICK_ID,
		t2.CLICK_USER_NICKNAME,
		t2.CLICK_USER_HEADIMGURL,
		t2.WATCH_TIME,
		t2.CREATE_DATE,
		t2.CREATE_TIME,
		t2.SHARE_STATE,
		t2.FROM_SHARE_STATE,
		t1.ARTICLE_ID,
		t1.ARTICLE_NAME,
		t1.PUSH_DATE,
		t1.ARTICLE_AUTHOR     
	FROM
		article_info t1,
		click_track_info t2
	WHERE
		t1.ARTICLE_ID = #{articleId} and t1.COMPANY_ID = #{companyId}
		AND t1.ARTICLE_ID = t2.ARTICLE_ID

		
		limit #{startRow},#{rows}
	</select>

	<select id="clerkArticleCount" resultType="java.lang.Integer">
		select count(1) from article_info t1,click_track_info t2
		where t1.COMPANY_ID = #{companyId}
		and t1.ARTICLE_ID = #{articleId}
		and t1.ARTICLE_ID = t2.ARTICLE_ID
	</select>


	<select id="queryArticleInfoList" resultMap="ArticleInfoResultMap">
		select t.PUBLISH_VIEW_URL,t.PUBLISH_EDIT_URL,
		t1.ARTICLE_ID,t1.ARTICLE_NAME,t1.PUSH_DATE,t1.ARTICLE_AUTHOR,t1.LIST_PIC_URL,t1.SPECIAL,
		t1.CHANNEL_ID,t1.COMPANY_ID,t1.ORIGINAL_URL,t1.SHARE_IMG_URL,t1.SHARE_TITLE,t1.ARTICLE_STATE,
		t1.SHARE_DES,t1.CREATE_DATE,t1.CREATE_TIME,t1.CREATE_USER,t1.UPDATE_DATE,t1.UPDATE_TIME,(select
		count(1) from click_track_info where ARTICLE_ID = t1.ARTICLE_ID )
		WATCHCOUNT ,
		(select count(1) from click_track_info where ARTICLE_ID = t1.ARTICLE_ID and
		SHARE_STATE in ('1','2','5') ) SHARECOUNT from article_publish_track
		t,article_info t1
		where t.user_id in (select user_id from user_info where COMPANY_ID =
		#{companyId})
		and t.ARTICLE_ID = t1.ARTICLE_ID
		<if test="articelAuthor != null and articelAuthor != ''">
			and t1.ARTICLE_AUTHOR = #{articelAuthor}
		</if>
		<if test="articelName != null and articelName != ''">
			and t1.ARTICLE_NAME = #{articelName}
		</if>
		<if test="channelId != null and channelId != ''">
			and t1.CHANNEL_ID = #{channelId}
		</if>
		<if test="special != null and special != ''">
			and t1.SPECIAL = #{special}
		</if>
		and (COMPANY_ID is null or COMPANY_ID = '')
		order by t.create_date desc,t.create_time desc limit #{startRow},#{rows}
	</select>

	<select id="articleInfoCount" resultType="java.lang.Integer">
		select count(1) from article_publish_track t,article_info t1
		where t.user_id in (select user_id from user_info where COMPANY_ID =
		#{companyId})
		and t.ARTICLE_ID = t1.ARTICLE_ID
		<if test="articelAuthor != null and articelAuthor != ''">
			and t1.ARTICLE_AUTHOR = #{articelAuthor}
		</if>
		<if test="articelName != null and articelName != ''">
			and t1.ARTICLE_NAME = #{articelName}
		</if>
		<if test="channelId != null and channelId != ''">
			and t1.CHANNEL_ID = #{channelId}
		</if>
		<if test="special != null and special != ''">
			and t1.SPECIAL = #{special}
		</if>
		and (COMPANY_ID is null or COMPANY_ID = '')
	</select>

	<select id="selClerkArticleContent" resultMap="ArticleInfoResultMap">
		select t.PUBLISH_VIEW_URL,t.PUBLISH_EDIT_URL,t1.* from article_publish_track t,article_info t1
		where t.user_id in (select user_id from user_info where
		COMPANY_ID=#{companyId})
		and t.ARTICLE_ID = #{articleId}
		and t.ARTICLE_ID = t1.ARTICLE_ID
	</select>
</mapper>